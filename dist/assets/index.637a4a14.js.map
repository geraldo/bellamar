{"version":3,"file":"index.637a4a14.js","sources":["../../vite/modulepreload-polyfill","../../main.js"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","import './style.css';\n\nimport {Map, View, Feature} from 'ol';\nimport {Tile as TileLayer, Vector as VectorLayer, Group as GroupLayer} from 'ol/layer';\nimport {OSM, TileWMS, TileArcGISRest, Vector as VectorSource, XYZ} from 'ol/source';\nimport {ScaleLine, defaults as defaultControls, Attribution} from 'ol/control';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport {Select, Draw} from 'ol/interaction';\nimport {Overlay as OverlayOL} from 'ol';\nimport {Style, Stroke, Fill, Circle, Icon} from 'ol/style';\nimport {LineString, Polygon, Point} from 'ol/geom';\nimport {getArea, getLength} from 'ol/sphere';\nimport {unByKey} from 'ol/Observable';\nimport {get as getProjection, transform, fromLonLat, toLonLat} from 'ol/proj';\nimport {register} from 'ol/proj/proj4';\n\nimport LayerSwitcher from 'ol-layerswitcher';\nimport Permalink from 'ol-ext/control/Permalink';\nimport Bar from 'ol-ext/control/Bar';\nimport Button from 'ol-ext/control/Button';\nimport Toggle from 'ol-ext/control/Toggle';\nimport Overlay from 'ol-ext/control/Overlay';\nimport GeolocationButton from 'ol-ext/control/GeolocationButton';\nimport Popup from 'ol-ext/overlay/Popup';\nimport proj4 from 'proj4';\n\nimport $ from 'jquery';\nimport Cookies from 'js-cookie';\nimport i18next from 'i18next';\n\nconst zoomInit = 16,\n      coordsInit = fromLonLat([ 1.957, 41.271 ]),\n      qgisserverUrl = 'https://mapa.psig.es/qgisserver/cgi-bin/qgis_mapserv.fcgi',\n      mapproxyUrl = 'https://mapa.psig.es/mapproxy/service',\n      wfsUrl = 'https://mapa.psig.es/qgisserver/wfs3/collections/',\n      wfsItems = '/items.geojson',\n      wfsMapPath = '?MAP=/home/ubuntu/bellamar/Obra_Bellamar_web.qgs',\n      wfsLimit = '&limit=10000';\n\nlet caToggle,\n    esToggle,\n    docsToggle,\n    layersToggle,\n    searchToggle,\n    urlBtn,\n    geolocBtn,\n    measureToggle,\n    distanceToggle,\n    areaToggle,\n    windowDocs,\n    windowFeature;\n\n// https://epsg.io/25831\nproj4.defs(\"EPSG:25831\",\"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\");\nregister(proj4);\n\n/*\n * Base Layers\n *****************************************/\nlet ninguLayer = new TileLayer({\n  title: 'Ningú',\n  type: 'base',\n  source: null,\n  visible: false,\n});\n\nlet osmLayer = new TileLayer({\n  title: 'OpenStreetMap',\n  type: 'base',\n  visible: false,\n  source: new OSM()\n});\n\nlet ortoLayer = new TileLayer({\n  title: 'Ortofoto històrica de 2020 (AMB)',\n  type: 'base',\n  visible: false,\n  source: new TileArcGISRest({\n    url: 'https://geoportal.amb.cat/geoserveis/rest/services/ortofoto_territorial_10cm_2020_25831/MapServer',\n    projection: 'EPSG:25831',\n    params: {\n      'LAYERS': 'Orto2020_10cm'\n    },\n    attributions: ['© <a target=\"_blank\" href=\"https://www.amb.cat/\">AMB</a>'],\n  })\n});\n\nlet topoBaseLayer = new TileLayer({\n  title: 'Topográfic (ICGC)',\n  type: 'base',\n  visible: true,\n  maxZoom: 18,\n  source: new TileWMS({\n    url: 'https://geoserveis.icgc.cat/icc_mapesmultibase/utm/wms/service?',\n    params: {\n      'LAYERS': 'topogris', \n      'VERSION': '1.1.1'\n    },\n    attributions: ['Cartografia topogràfica 1:1.000 de l’<a target=\"_blank\" href=\"https://www.icgc.cat/\">Institut Cartogràfic i Geològic de Catalunya (ICGC)</a>, sota una llicència <a target=\"_blank\" href=\"https://creativecommons.org/licenses/by/4.0/deed.ca\">CC BY 4.0</a>'],\n   })\n});\n\nlet baseLayers = new GroupLayer({\n  title: 'Mapes base',\n  //fold: 'close',\n  layers: [\n    ninguLayer,\n    osmLayer,\n    ortoLayer,\n    topoBaseLayer\n  ]\n});\n\n/*\n * Overlay Layers\n *****************************************/\nlet topoLayer = new TileLayer({\n  title: 'Topografia completa',\n  visible: true,\n  minZoom: 18,\n  source: new TileWMS({\n    //url: qgisserverUrl + wfsMapPath,\n    url: mapproxyUrl + wfsMapPath,\n    params: {\n      'LAYERS': 'bellamar_topografia',\n      //'LAYERS': 'Anotacions,Vegetació (punts),Comunicacions (lineas),Vegetació (líneas),Construccions (líneas),Hidrografia (líneas)',\n      'TRANSPARENT': true,\n      'VERSION': '1.3.0',\n    },\n    serverType: 'qgis'\n  })\n});\n\nlet catastroLayer = new TileLayer({\n  title: 'Catastro',\n  visible: false,\n  source: new TileWMS({\n    url: 'https://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx',\n    params: {\n      'LAYERS': 'catastro', \n      'TILED': true,\n      'SRS': 'EPSG:3857'\n    }\n  })\n});\n\nlet pluvialLayer = new VectorLayer({\n  title: 'Pluvial',\n  visible: true,\n  source: new VectorSource({\n    format: new GeoJSON(),\n    url: wfsUrl + 'bellamar_pluvial' + wfsItems + wfsMapPath + wfsLimit\n    //url: 'bellamar_pluvial.geojson'\n  }),\n  style: new Style({\n    stroke: new Stroke({\n      lineDash: [10, 5],\n      color: '#1f78b4',\n      width: 3\n    })\n  })\n});\n\nlet tramsLayer = new VectorLayer({\n  title: 'Trams de les obres',\n  name: 'trams',\n  visible: true,\n  source: new VectorSource({\n    format: new GeoJSON(),\n    url: wfsUrl + 'Trams de les obres' + wfsItems + wfsMapPath + wfsLimit\n    //url: 'Trams de les obres.geojson'\n  }),\n  style: function(feature, resolution) {\n    let estat = feature.get('estat');\n\n    if (estat === 'finalitzat') {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(9,222,0,0.8)\",\n          width: 4\n        })\n      })\n    }\n    else if (estat === 'en obra') {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(219,30,42,0.8)\",\n          width: 4\n        })\n      })\n    }\n    else if (estat === 'inici en breu') {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(255,140,0,0.8)\",\n          width: 4\n        })\n      })\n    }\n    else if (estat === 'pendent') {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(0,118,182,0.8)\",\n          width: 4\n        })\n      })\n    }\n    else if (estat === 'exclòs') {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(146,147,151,0.5)\",\n          width: 3\n        })\n      })\n    }\n    else {\n      return new Style({\n        stroke: new Stroke({\n          color: \"rgba(255,255,0,0.5)\",\n          width: 2\n        })\n      })\n    }\n  }\n});\n\nlet parcellesLayer = new VectorLayer({\n  title: 'Parcel·les projecte Bellamar',\n  name: 'parcelles',\n  visible: true,\n  source: new VectorSource({\n    format: new GeoJSON(),\n    url: wfsUrl + 'Parcel·les projecte Bellamar' + wfsItems + wfsMapPath + wfsLimit\n    //url: 'Parcel·les projecte Bellamar.geojson'\n  }),\n  style: function(feature, resolution) {\n    if (feature.get('residual') === 'No') {\n      return new Style({\n        fill: new Fill({\n          //color: \"#c49a97\"\n          color: \"rgba(196,154,151,0.4)\"\n        })\n      })\n    }\n    else if (feature.get('residual') === 'Sí') {\n      return new Style({\n        fill: new Fill({\n          //color: \"#876964\"\n          color: \"rgba(135,105,100,0.4)\"\n        })\n      })\n    }\n    else {\n      return null;\n    }\n  }\n});\n\nlet barrisLayer = new VectorLayer({\n  title: 'Barris',\n  visible: true,\n  source: new VectorSource({\n    format: new GeoJSON(),\n    url: 'barris.geojson',\n  }),\n  style: new Style({\n    stroke: new Stroke({\n      color: \"#000\",\n      width: 2\n    })\n  })\n});\n\n/*\n * Map\n *****************************************/\nconst map = new Map({\n  target: 'map',\n  controls: defaultControls().extend([new ScaleLine()]),\n  layers: new GroupLayer({\n    fold: 'close',\n    layers: [\n      baseLayers,\n      catastroLayer,\n      topoLayer,\n      barrisLayer,\n      pluvialLayer,\n      tramsLayer,\n      parcellesLayer,\n    ]\n  }),\n  view: new View({\n    //center: fromLonLat([1.982, 41.286]),\n    center: coordsInit,\n    zoom: zoomInit,\n    minZoom: 14,\n    maxZoom: 20\n  })\n});\n\n/*\n * Menu\n *****************************************/\nfunction renderMenu() {\n  windowDocs = new Overlay({ \n    closeBox : true, \n    className: \"slide-left menu\", \n    content: $(\"#windowDocs\").get(0)\n  });\n  map.addControl(windowDocs);\n\n  let windowLayers = new Overlay({ \n    closeBox : true, \n    className: \"slide-left menu\", \n    content: $(\"#windowLayers\").get(0)\n  });\n  map.addControl(windowLayers);\n\n  LayerSwitcher.renderPanel(map, document.getElementById(\"layerSwitcher\"), { reverse: true });\n\n  let windowSearch = new Overlay({ \n    closeBox : true, \n    className: \"slide-left menu\", \n    content: $(\"#windowSearch\").get(0)\n  });\n  map.addControl(windowSearch);\n\n  windowFeature = new Overlay({ \n    closeBox : true, \n    className: \"slide-right info\", \n    content: $(\"#windowFeature\").get(0)\n  });\n  map.addControl(windowFeature);\n\n  let menuBar = new Bar({\n    className: \"ol-top ol-left menuBar\"\n  });\n  map.addControl(menuBar);\n\n  let actionBar = new Bar({ toggleOne: true, group: true });\n  menuBar.addControl(actionBar);\n\n  let logoBtn = new Button({ \n    html: '<img src=\"logo.png\" />',\n    className: \"logo\",\n    title: \"Castelldefels\",\n    handleClick: function() { \n      map.getView().setCenter(coordsInit);\n      map.getView().setZoom(zoomInit);\n    }\n  });\n  actionBar.addControl(logoBtn);\n\n  docsToggle = new Toggle({ \n    html: '<i class=\"fa fa-file-text-o\"></i>',\n    className: \"docsToggle\",\n    onToggle: function() {\n      hideWindows(\"docs\");\n      windowDocs.toggle();\n    }\n  });\n  actionBar.addControl(docsToggle);\n\n  layersToggle = new Toggle({ \n    html: '<i class=\"fa fa-align-justify\"></i>',\n    className: \"layersToggle\",\n    onToggle: function() {\n      hideWindows(\"layers\");\n      windowLayers.toggle();\n    }\n  });\n  actionBar.addControl(layersToggle);\n\n  searchToggle = new Toggle({ \n    html: '<i class=\"fa fa-search\"></i>',\n    className: \"searchToggle\",\n    onToggle: function() {\n      hideWindows(\"search\");\n      windowSearch.toggle();\n    }\n  });\n  actionBar.addControl(searchToggle);\n\n  function hideWindows(activeToggle) {\n    windowDocs.hide();\n    windowLayers.hide();\n    windowSearch.hide();\n\n    if (activeToggle !== \"docs\")\n      docsToggle.setActive(false);\n    else if (activeToggle !== \"layers\")\n      layersToggle.setActive(false);\n    else if (activeToggle !== \"search\")\n      searchToggle.setActive(false);\n  }\n\n  let whatsappBtn = new Button({ \n    html: '<i class=\"fa fa-whatsapp\" aria-hidden=\"true\"></i>',\n    className: \"whatsapp\",\n    title: \"Whatsapp\",\n    handleClick: function() { \n      \n    }\n  });\n  actionBar.addControl(whatsappBtn);\n\n  let telegramBtn = new Button({ \n    html: '<i class=\"fa fa-telegram\" aria-hidden=\"true\"></i>',\n    className: \"telegram\",\n    title: \"Telegram\",\n    handleClick: function() { \n      \n    }\n  });\n  actionBar.addControl(telegramBtn);\n\n  let languageBar = new Bar({ toggleOne: true, group: true });\n  menuBar.addControl(languageBar);\n\n  caToggle = new Toggle({ \n    html: 'CA',\n    className: \"lang ca\",\n    title: \"Català\",\n    onToggle: function() {\n      i18next.changeLanguage('ca');\n    }\n  });\n  languageBar.addControl(caToggle);\n\n  esToggle = new Toggle({ \n    html: 'ES',\n    className: \"lang es\",\n    title: \"Castellano\",\n    onToggle: function() {\n      i18next.changeLanguage('es');\n    }\n  });\n  languageBar.addControl(esToggle);\n\n  $(\".window\").show();\n}\n\n/*\n * Action buttons\n *****************************************/\nfunction renderButtons() {\n  urlBtn = new Permalink({ \n    urlReplace: true\n  });\n  map.addControl(urlBtn);\n\n  geolocBtn = new GeolocationButton({\n    delay: 5000\n  });\n  map.addControl(geolocBtn);\n\n  let here = new Popup({ positioning: 'bottom-center' });\n  map.addOverlay(here);\n  geolocBtn.on('position', function(e) {\n    if (e.coordinate) here.show(e.coordinate, \"Ets aquí!\");\n    else here.hide();\n  });\n\n  /*\n   * Measure\n   *****************************************/\n  let sketch,\n      helpTooltipElement,\n      helpTooltip,\n      measureTooltipElement,\n      measureTooltip,\n      continuePolygonMsg = 'Click per continuar dibuixant el polígon',\n      continueLineMsg = 'Click per continuar dibuixant la línea',\n      helpMsg = 'Clica per iniciar el dibuix',\n      draw,\n      measureActive = false;\n\n  const measureSource = new VectorSource();\n  const measureVector = new VectorLayer({\n    source: measureSource,\n    style: new Style({\n      fill: new Fill({\n        color: 'rgba(255, 255, 255, 0.2)',\n      }),\n      stroke: new Stroke({\n        color: '#ffcc33',\n        width: 2,\n      }),\n      image: new Circle({\n        radius: 7,\n        fill: new Fill({\n          color: '#ffcc33',\n        }),\n      }),\n    }),\n  });\n  map.addLayer(measureVector);\n\n  map.on('pointermove', function(evt) {\n    if (measureActive) {\n      pointerMoveHandler(evt);\n    }\n    else {\n      // change mouse pointer over features\n      map.getTargetElement().style.cursor = map.hasFeatureAtPixel(map.getEventPixel(evt.originalEvent), { \n        hitTolerance: 5, \n        layerFilter: function (layer) {\n          return layer.get('name') === 'trams' || layer.get('name') === 'parcelles'\n        }\n      }) ? 'pointer' : '';\n    }\n  });\n\n  $(document).keyup(function(e) {\n    if (e.keyCode == 27) {\n      map.removeInteraction(draw);\n      map.removeOverlay(measureTooltip);\n      removeHelpTooltip();\n      $('.ol-tooltip').addClass('hidden');\n      measureToggle.toggle();\n      //measureSource.clear();\n    }\n  });\n\n  distanceToggle = new Toggle({ \n    //html:'<i class=\"fa fa-arrows-h\"></i>', \n    html: '<svg height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"https://www.w3.org/2000/svg\"><g transform=\"translate(0 -8)\"><path d=\"m1.5000001 20.5h21v7h-21z\" style=\"overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square\"/><path d=\"m4.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m7.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m10.5 20v6\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m13.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m16.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m19.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m2.5 13v4\" fill=\"none\" stroke=\"#415a75\"/><path d=\"m21.5 13v4\" fill=\"none\" stroke=\"#415a75\"/><path d=\"m2 15h20\" fill=\"none\" stroke=\"#415a75\" stroke-width=\"1.99999988\"/></g></svg>',\n    //autoActivate: true,\n    onToggle: function(b) { \n      measureActive = b;\n      enableInteraction(b, true);\n    } \n  }),\n  areaToggle = new Toggle({ \n    //html:'<i class=\"fa fa-arrows-alt\"></i>', \n    html: '<svg height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"https://www.w3.org/2000/svg\"><g transform=\"translate(0 -8)\"><path d=\"m1.5000001 20.5h21v7h-21z\" style=\"overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square\"/><path d=\"m4.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m7.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m10.5 20v6\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m13.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m16.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m19.5 21v3\" fill=\"none\" stroke=\"#5b5b5c\"/><path d=\"m2.5 9.5h5v2h14v7.5h-6.5v-5h-5v3.5h-7.5z\" fill=\"#6d97c4\" fill-rule=\"evenodd\" stroke=\"#415a75\"/></g></svg>',\n    onToggle: function(b) { \n      measureActive = b;\n      enableInteraction(b, false);\n    }\n  })\n\n  let submeasureBar = new Bar({ \n    toggleOne: true,\n    autoDeactivate: true,\n    controls: [ \n      distanceToggle,\n      areaToggle\n    ]\n  });\n  measureToggle = new Toggle({ \n    html: 'M',\n    bar: submeasureBar,\n    onToggle: function(b) {\n      if (!b) {\n        removeMeasure();\n        this.toggle();\n      }\n    }\n  });\n  let measureBar = new Bar({ \n    autoDeactivate: true,\n    controls: [measureToggle],\n    className: \"ol-top ol-right measureBar\"\n  });\n  map.addControl(measureBar);\n\n  function enableInteraction(enable, distance) {\n    enable ? addInteraction(distance) : removeMeasure();\n  }\n\n  function addInteraction(distance) {\n    var type = (distance ? 'LineString' : 'Polygon');\n    draw = new Draw({\n      source: measureSource,\n      type: type,\n      style: new Style({\n        fill: new Fill({\n          color: 'rgba(255, 255, 255, 0.2)'\n        }),\n        stroke: new Stroke({\n          color: 'rgba(0, 0, 0, 0.5)',\n          lineDash: [10, 10],\n          width: 2\n        }),\n        image: new Circle({\n          radius: 5,\n          stroke: new Stroke({\n            color: 'rgba(0, 0, 0, 0.7)'\n          }),\n          fill: new Fill({\n            color: 'rgba(255, 255, 255, 0.2)'\n          })\n        })\n      })\n    });\n\n    map.addInteraction(draw);\n    createMeasureTooltip();\n    createHelpTooltip();\n\n    let listener;\n\n    draw.on('drawstart', function(evt) {\n      sketch = evt.feature;\n\n      var tooltipCoord = evt.coordinate;\n\n      listener = sketch.getGeometry().on('change', function(evt) {\n      var geom = evt.target;\n      var output;\n      if (geom instanceof Polygon) {\n        output = formatArea(geom);\n        tooltipCoord = geom.getInteriorPoint().getCoordinates();\n      } else if (geom instanceof LineString) {\n        output = formatLength(geom);\n        tooltipCoord = geom.getLastCoordinate();\n      }\n      measureTooltipElement.innerHTML = output;\n      measureTooltip.setPosition(tooltipCoord);\n      });\n    });\n\n    draw.on('drawend', function() {\n      measureTooltipElement.className = 'ol-tooltip ol-tooltip-static';\n      measureTooltip.setOffset([0, -7]);\n      sketch = null;\n      measureTooltipElement = null;\n      createMeasureTooltip();\n      unByKey(listener);\n    });\n  }\n\n  function removeMeasure() {\n    measureActive = false;\n    map.removeInteraction(draw);\n    map.removeOverlay(measureTooltip);\n    removeHelpTooltip();\n    $('.ol-tooltip').addClass('hidden');\n    measureToggle.toggle();\n    measureSource.clear();\n  }\n\n  function createHelpTooltip() {\n    removeHelpTooltip();\n    helpTooltipElement = document.createElement('div');\n    helpTooltipElement.className = 'ol-tooltip hidden';\n    helpTooltip = new OverlayOL({\n      element: helpTooltipElement,\n      offset: [15, 0],\n      positioning: 'center-left'\n    });\n    map.addOverlay(helpTooltip);\n\n    map.getViewport().addEventListener('mouseout', helpTooltipEventListener);\n  }\n\n  var helpTooltipEventListener = function() {\n    helpTooltipElement.classList.add('hidden');\n  }\n\n  function removeHelpTooltip() {\n    map.removeOverlay(helpTooltip);\n    map.getViewport().removeEventListener('mouseout', helpTooltipEventListener);\n  }\n\n  function createMeasureTooltip() {\n    if (measureTooltipElement) {\n      measureTooltipElement.parentNode.removeChild(measureTooltipElement);\n    }\n    measureTooltipElement = document.createElement('div');\n    measureTooltipElement.className = 'ol-tooltip ol-tooltip-measure';\n    measureTooltip = new OverlayOL({\n      element: measureTooltipElement,\n      offset: [0, -15],\n      positioning: 'bottom-center',\n      stopEvent: false,\n      insertFirst: false,\n    });\n    map.addOverlay(measureTooltip);\n  }\n\n  var pointerMoveHandler = function(evt) {\n  if (evt.dragging) {\n    return;\n  }\n\n  if (sketch) {\n    var geom = (sketch.getGeometry());\n    if (geom instanceof Polygon) {\n      helpMsg = continuePolygonMsg;\n    } else if (geom instanceof LineString) {\n      helpMsg = continueLineMsg;\n    }\n  }\n\n    if (helpTooltipElement && helpTooltipElement !== undefined) {\n      helpTooltipElement.innerHTML = helpMsg;\n      helpTooltip.setPosition(evt.coordinate);\n      helpTooltipElement.classList.remove('hidden');\n    }\n  };\n\n  var formatLength = function(line) {\n    var length = getLength(line);\n    var output;\n    if (length > 100) {\n      output = (Math.round(length / 1000 * 100) / 100) + ' ' + 'km';\n    } \n    else {\n      output = (Math.round(length * 100) / 100) + ' ' + 'm';\n    }\n    return output;\n  };  \n\n  var formatArea = function(polygon) {\n    var area = getArea(polygon);\n    var output;\n    if (area > 10000) {\n      output = (Math.round(area / 1000000 * 100) / 100) + ' ' + 'km<sup>2</sup>';\n    } \n    else {\n      output = (Math.round(area * 100) / 100) + ' ' + 'm<sup>2</sup>';\n    }\n    return output;\n  };\n}\n\n/*\n * Interaction\n *****************************************/\nlet highlightStyle = new Style({\n  stroke: new Stroke({\n    color: \"#ffff00\",\n    width: 5\n  }),\n  fill: new Fill({\n    color: 'rgba(255,255,0,0.3)'\n  })\n});\n\nlet select = new Select({ \n  layers: [tramsLayer, parcellesLayer],\n  hitTolerance: 5,\n  style: highlightStyle\n});\nmap.addInteraction(select);\n\n// On selected => show/hide popup\nselect.getFeatures().on('add', function(e) {\n  let feature = e.element,\n      layer = select.getLayer(feature).get('name'),\n      content = $(\"<div>\");\n\n  if (layer === \"trams\") {\n    content\n      .append( getField(feature, \"eix_ncar\") )\n      .append( getField(feature, \"observacions\") )\n      .append( getField(feature, \"estat\") )\n      .append( getField(feature, \"data_inici_obres\") )\n      .append( getField(feature, \"data_fi_obres\") );\n  }\n  else if (layer === \"parcelles\") {\n    content\n      .append( getField(feature, \"refcat\") )\n      .append( getField(feature, \"residual\") )\n      .append( getField(feature, \"conveni\") );\n  }\n\n  $(\"#windowFeature .content\").html(content);\n  windowFeature.show();\n});\nselect.getFeatures().on('remove', function(e) { \n  $(\"#windowFeature .content\").html(\"\");\n  windowFeature.hide();\n});\n\nfunction getField(feature, key) {\n  let val = feature.get(key);\n  if (key === \"estat\") {\n    val = i18next.t(\"feature.\"+val);\n  }\n\n  if (val === null) {\n    return \"\";\n  }\n\n  return $(\"<p>\").html(\n    \"<span class='label \" + key + \"'>\" + \n    i18next.t(\"feature.\"+key) + \n    \"</span>: \" + \n    val\n  );\n}\n\n/*\n * Cercadors\n *****************************************/\n$.get(\"./carrers.txt\", function(data) {\n  let carrers = data.split(',\\n');\n  let n = carrers.length;  \n\n  $(\"#searchCarrer\").keyup(function(e) {\n\n    document.getElementById('carrerList').innerHTML = '';\n    $(\"#searchNumero\").empty();\n\n    for (let i = 0; i<n; i++) {\n      let carrer = carrers[i].split(',');\n      if(((carrer[1].toLowerCase()).indexOf($(\"#searchCarrer\").val().toLowerCase()))>-1) {\n\n        let node = document.createElement(\"option\"),\n            val = document.createTextNode(carrer[1]),\n            attr = document.createAttribute(\"value\");\n        //attr.value = carrer[0];\n        //node.setAttributeNode(attr);\n        node.appendChild(val);\n        node.setAttribute(\"data-id\", carrer[0]);\n\n        document.getElementById(\"carrerList\").appendChild(node);\n      }\n    }\n  });\n\n  $(\"#searchCarrer\").on('input', function (e) {\n    $(\"#searchMsg\").text(\"\");\n    \n    let val = this.value;\n    let id = -1;\n    if($('#carrerList option').filter(function(){\n      if (this.value === val) id = this.dataset.id;\n      return (this.value === val);\n    }).length) {\n      loadCarrerNums(id);\n    }\n  });\n\n  function loadCarrerNums(carrer) {\n\n    if (carrer && carrer !== \"\" && carrer !== -1) {\n\n      $.ajax({\n        url: './ajaxfile.php',\n        type: 'post',\n        data: {\n          request: 'carrersNum',\n          carrer: carrer\n        },\n        dataType: 'json',\n        success: function(response){\n          if (response.length > 0) {\n            $(\"#searchNumero\").empty();\n            $(\"#searchNumero\").append('<option value=\"-1\">'+i18next.t('search.searchOption')+'</option>');\n            for (let i in response) {\n              let geom = JSON.parse(response[i].geom);\n              $(\"#searchNumero\").append('<option data-x=\"'+geom.coordinates[0][0]+'\" data-y=\"'+geom.coordinates[0][1]+'\">'+response[i].npol_num1+'</option>');\n            }\n          }\n          else {\n            $(\"#searchMsg\").text(\"No ha hi cap número de aquest carrer.\")\n          }\n        }\n      });\n    }\n  }\n});\n\n// search number selection\n$(\"#searchNumero\").on(\"change\", function() {\n  var x = Number(this.options[this.selectedIndex].getAttribute('data-x'));\n  var y = Number(this.options[this.selectedIndex].getAttribute('data-y'));\n    \n  if (isNumeric(x) && isNumeric(y)) {\n    zoomToCoord(x,y,false);\n    showIcon([x,y]);\n  }\n\n  return false;\n});\n\n$(\"#searchReferenciaBtn\").click(function() {\n  $(\"#searchMsg\").text(\"\");\n  if (parcelaSource !== null) parcelaSource.clear();\n  let refcat = $(\"#searchReferencia\").val().trim();\n\n  if (refcat && refcat !== \"\") {\n\n    $.ajax({\n      url: './ajaxfile.php',\n      type: 'post',\n      data: {\n        request: 'catasterGeom',\n        refcat: refcat\n      },\n      dataType: 'json',\n      success: function(response){\n        if (response.length > 0) {\n          zoomToCoord(response[0].coorx, response[0].coory,true);\n          highlightPoligon(response[0].geom);\n        }\n        else {\n          $(\"#searchMsg\").text(\"No ha hi cap parcela amb aquesta referència cadastral.\")\n        }\n      }\n    });\n  }\n});\n\nfunction zoomToCoord(x,y,reproject=false) {\n  // check if in bounds of layers with: \n  // SELECT ST_Extent(geom) from limit_admin.tm_limit_lin;\n      // result: \"BOX(409978.249378971 4587601.47112343,416985.690776374 4597348.5951092)\"\n  //if (x > 409978.249378971 && x < 416985.690776374 && y > 4587601.47112343 && y < 4597348.5951092) {\n\n    console.log(\"zoomToCoord:\"+x+\":\"+y);\n\n    let coord = [x, y];\n    if (reproject) {\n      coord = transform([x, y], getProjection('EPSG:25831'), 'EPSG:3857');\n    }\n\n    map.getView().animate({\n      zoom: map.getView().getZoom()+1, \n      center: coord,\n      duration: 2000\n    });\n\n    // show icon\n    //showIcon(coord);\n\n    // show feature info if radio selected\n    /*if ($('input[name=searchinfo]:checked').val() === \"info\") {\n      selectFeatureInfo(coord);\n      $(\"#infoPanel\").show();\n    }*/\n  /*}\n  else {\n    console.log(\"zoomToCoord problem, x or y out of bounds: \"+x+\":\"+y);\n  }*/\n}\n\n// highlight geom of parcela\nlet parcelaLayer = null,\n    parcelaSource = null;\nfunction highlightPoligon(geom) {\n  if (geom) {\n    //console.log(\"highlightPoligon: \"+geom);\n\n    if (parcelaLayer === null) {\n\n      parcelaSource = new VectorSource({\n        features: (new GeoJSON()).readFeatures(geom)\n      });\n\n      parcelaLayer = new VectorLayer({\n        source: parcelaSource,\n        style: highlightStyle\n      });\n\n      map.addLayer(parcelaLayer);\n    }\n\n    else {\n      parcelaSource.clear();\n      parcelaSource.addFeatures((new GeoJSON()).readFeatures(geom));\n    }\n  }\n}\n\n// draw icon on coord\nlet iconLayer = null,\n    iconPoint = null;\nfunction showIcon(coord) {\n\n  console.log(\"showIcon:\"+coord[0]+\":\"+coord[1]);\n\n  if (iconLayer === null) {\n    iconPoint = new Point(coord);\n    iconLayer = new VectorLayer({\n      source: new VectorSource({\n        features: [\n          new Feature({\n            geometry: iconPoint,\n          })\n        ]\n      }),\n      style: new Style({\n        image: new Icon(({\n          anchor: [0.5, 0],\n          anchorOrigin: 'bottom-left',\n          color: [255, 0, 0, 1],\n          src: './marker.png'\n        }))\n      })\n    });\n    map.addLayer(iconLayer);\n\n    // hide Icon when info panel is closed\n    /*$(\"#infoPanel\").on(\"click\", \"a.pull-right\", function(){\n      map.removeLayer(iconLayer);\n      iconLayer = null;\n      if (parcelaLayer !== null) parcelaSource.clear();\n        return false;\n    });*/\n  }\n  else {\n    iconPoint.setCoordinates(coord);\n  }\n}\n\nfunction isNumeric(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n};\n\nmap.on('click', function(evt) {\n  if (parcelaSource !== null) parcelaSource.clear();\n  map.removeLayer(iconLayer);\n  iconLayer = null;\n  console.log(toLonLat(evt.coordinate));\n});\n\n/*\n * Cookies\n *****************************************/\nconst cookieOptions = { sameSite: 'strict', secure: true };\n\nfunction initCookies() {\n  if (Cookies.get('comeback') === undefined) {\n    Cookies.set('comeback', true, cookieOptions);\n    docsToggle.setActive(true);\n    windowDocs.show();\n  }\n\n  $.ajax({\n    url: './translations.json',\n    dataType: 'json',\n    success: function(response){\n      let lang = getCookies();\n\n      i18next.init({\n        lng: lang,\n        debug: true,\n        resources: response\n      }).then(function(t) {\n\n        translateContent();\n\n        i18next.on('languageChanged', () => {\n          Cookies.set('lang', i18next.language, cookieOptions);\n          //console.log(i18next.language, Cookies.get('lang'));\n\n          translateContent();\n        });\n      });\n    }\n  });\n}\n\nfunction getCookies() {\n  let lang = 'ca';\n\n  if (Cookies.get('lang') === undefined) {\n    /*let userLang = navigator.language || navigator.userLanguage;\n    if (userLang === 'ca' || userLang == 'es') {\n      lang = userLang;\n    }*/\n    Cookies.set('lang', lang, cookieOptions);\n  }\n  else {\n    lang = Cookies.get('lang');\n  }\n\n  //let userLang = navigator.language || navigator.userLanguage;\n  //console.log(\"The language is: \" + lang + \" (Browser language:\" + userLang + \")\");\n\n  if (lang === \"es\")\n    esToggle.setActive(true);\n  else\n    caToggle.setActive(true);\n\n  return lang;\n}\n\nfunction translateContent() {\n  // menu\n  docsToggle.setTitle(i18next.t('gui.documents'));\n  layersToggle.setTitle(i18next.t('gui.capes'));\n  searchToggle.setTitle(i18next.t('gui.search'));\n  $(\"#windowDocs .text\").text(i18next.t('gui.windowDocsText'));\n\n  // search window\n  $(\"#windowSearch .titleCarrer\").text(i18next.t('search.titleCarrer'));\n  $(\"#windowSearch .labelCarrer\").text(i18next.t('search.labelCarrer'));\n  $(\"#windowSearch .labelNumero\").text(i18next.t('search.labelNumero'));\n  $(\"#windowSearch #searchOption\").text(i18next.t('search.searchOption'));\n  $(\"#windowSearch .titleCatastro\").text(i18next.t('search.titleCatastro'));\n  $(\"#windowSearch .introCatastro\").text(i18next.t('search.introCatastro'));\n  $(\"#windowSearch .labelReferencia\").text(i18next.t('search.labelReferencia'));\n  $(\"#windowSearch .btnReferencia\").text(i18next.t('search.btnReferencia'));\n\n  // buttons\n  $(\".ol-permalink button\").attr(\"title\", i18next.t('gui.urlmsg'));\n  geolocBtn.setTitle(i18next.t('gui.geopos'));\n  measureToggle.setTitle(i18next.t('gui.measure'));\n  distanceToggle.setTitle(i18next.t('gui.measureDistance'));\n  areaToggle.setTitle(i18next.t('gui.measureArea'));\n  $(\".ol-attribution button\").attr(\"title\", i18next.t('gui.attribution'));\n\n  // windows\n  $(\"#windowDocs .title\").text(i18next.t('gui.windowDocsTitle'));\n  $(\"#windowLayers .title\").text(i18next.t('gui.windowLayersTitle'));\n  $(\"#windowSearch .title\").text(i18next.t('gui.windowSearchTitle'));\n  $(\"#windowFeature .title\").text(i18next.t('gui.windowFeatureTitle'));\n\n  // labels\n  $(\"#windowFeature .label.eix_ncar\").text(i18next.t('feature.eix_ncar'));\n  $(\"#windowFeature .label.observacions\").text(i18next.t('feature.observacions'));\n  $(\"#windowFeature .label.estat\").text(i18next.t('feature.estat'));\n  $(\"#windowFeature .label.data_inici_obres\").text(i18next.t('feature.data_inici_obres'));\n  $(\"#windowFeature .label.data_fi_obres\").text(i18next.t('feature.data_fi_obres'));\n  $(\"#windowFeature .label.refcat\").text(i18next.t('feature.refcat'));\n  $(\"#windowFeature .label.residual\").text(i18next.t('feature.residual'));\n  $(\"#windowFeature .label.conveni\").text(i18next.t('feature.conveni'));\n\n  // layerswitcher\n  parcellesLayer.set(\"title\", i18next.t('switcher.parcellesLayer'));\n  tramsLayer.set(\"title\", i18next.t('switcher.tramsLayer'));\n  pluvialLayer.set(\"title\", i18next.t('switcher.pluvialLayer'));\n  barrisLayer.set(\"title\", i18next.t('switcher.barrisLayer'));\n  topoLayer.set(\"title\", i18next.t('switcher.topoLayer'));\n  catastroLayer.set(\"title\", i18next.t('switcher.catastroLayer'));\n  baseLayers.set(\"title\", i18next.t('switcher.baseLayers'));\n  topoBaseLayer.set(\"title\", i18next.t('switcher.topoBaseLayer'));\n  ortoLayer.set(\"title\", i18next.t('switcher.ortoLayer'));\n  osmLayer.set(\"title\", i18next.t('switcher.osmLayer'));\n  ninguLayer.set(\"title\", i18next.t('switcher.ninguLayer'));\n  LayerSwitcher.renderPanel(map, document.getElementById(\"layerSwitcher\"), { reverse: true });\n}\n\n/*\n * Cookies\n *****************************************/\n\n$(function() {\n  renderMenu();\n  renderButtons();\n  initCookies();\n})"],"names":["defaultControls","Overlay","Bar","Button","Toggle","i18next","Permalink","GeolocationButton","Popup","getProjection","Cookies"],"mappings":"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"}