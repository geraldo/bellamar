import{f as Oe,p as se,r as Ae,G as ce,T as N,O as Fe,a as Pe,b as Z,V as T,c as L,d as S,S as f,e as g,F as k,M as Ie,g as je,h as Ge,i as Re,j as Ve,$ as o,k as i,t as qe,l as De,P as ze,m as He,n as Ze,o as F,L as We,q as B,s as W,u as b,v as Ye,w as Ue,x as Je,C as ue,D as Ke,y as de,z as fe,A as $e,B as ge,E as Qe,H as Xe,I as _}from"./vendor.01066b28.js";const et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function l(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=l(a);fetch(a.href,r)}};et();const me=16,pe=Oe([1.957,41.271]),tt="https://mapa.psig.es/mapproxy/service",Y="https://mapa.psig.es/qgisserver/wfs3/collections/",U="/items.geojson",P="?MAP=/home/ubuntu/bellamar/Obra_Bellamar_web.qgs",J="&limit=10000";let K,$,M,I,j,we,G,E,Q,X,O,R;se.defs("EPSG:25831","+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");Ae(se);let ot=new ce({title:"Mapes base",layers:[new N({title:"Ning\xFA",type:"base",source:null,visible:!1}),new N({title:"OpenStreetMap",type:"base",visible:!1,source:new Fe}),new N({title:"Ortofoto hist\xF2rica de 2020 (AMB)",type:"base",visible:!1,source:new Pe({url:"https://geoportal.amb.cat/geoserveis/rest/services/ortofoto_territorial_10cm_2020_25831/MapServer",projection:"EPSG:25831",params:{LAYERS:"Orto2020_10cm"},attributions:['\xA9 <a target="_blank" href="https://www.amb.cat/">AMB</a>']})}),new N({title:"Topogr\xE1fic (AMB)",type:"base",visible:!0,maxZoom:18,source:new Z({url:"http://geoserveis.icc.cat/icc_mapesmultibase/utm/wms/service?",params:{LAYERS:"topogris",VERSION:"1.1.1"},attributions:['Cartografia topogr\xE0fica 1:1.000 de l\u2019<a target="_blank" href="http://www.icgc.cat/">Institut Cartogr\xE0fic i Geol\xF2gic de Catalunya (ICGC)</a>, sota una llic\xE8ncia <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/deed.ca">CC BY 4.0</a>']})})]}),at=new N({title:"Topografia completa",visible:!0,minZoom:18,source:new Z({url:tt+P,params:{LAYERS:"bellamar_topografia",TRANSPARENT:!0,VERSION:"1.3.0"},serverType:"qgis"})}),nt=new N({title:"Catastro",visible:!1,source:new Z({url:"http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx",params:{LAYERS:"catastro",TILED:!0,SRS:"EPSG:3857"}})}),rt=new T({title:"Pluvial",visible:!0,source:new L({format:new S,url:Y+"bellamar_pluvial"+U+P+J}),style:new f({stroke:new g({lineDash:[10,5],color:"#1f78b4",width:3})})}),he=new T({title:"Trams de les obres",name:"trams",visible:!0,source:new L({format:new S,url:Y+"Trams de les obres"+U+P+J}),style:function(e,t){let l=e.get("estat");return l==="finalitzat"?new f({stroke:new g({color:"#09de00",width:2})}):l==="en obra"?new f({stroke:new g({color:"#db1e2a",width:2})}):l==="inici en breu"?new f({stroke:new g({color:"#ff8c00",width:2})}):l==="pendent"?new f({stroke:new g({color:"#0076b6",width:2})}):l==="excl\xF2s"?new f({stroke:new g({color:"#929397",width:1})}):new f({stroke:new g({color:"#ffff00",width:1})})}}),ve=new T({title:"Parcel\xB7les projecte Bellamar",name:"parcelles",visible:!0,source:new L({format:new S,url:Y+"Parcel\xB7les projecte Bellamar"+U+P+J}),style:function(e,t){return e.get("residual")==="No"?new f({fill:new k({color:"rgba(196,154,151,0.4)"})}):e.get("residual")==="S\xED"?new f({fill:new k({color:"rgba(135,105,100,0.4)"})}):null}}),lt=new T({title:"Barris",visible:!0,source:new L({format:new S,url:"barris.geojson"}),style:new f({stroke:new g({color:"#000",width:2})})});const n=new Ie({target:"map",controls:je().extend([new Ge]),layers:new ce({title:"Mapes base",fold:"close",layers:[ot,nt,at,lt,rt,he,ve]}),view:new Re({center:pe,zoom:me,minZoom:14,maxZoom:20})});function it(){O=new F({closeBox:!0,className:"slide-left menu",content:o("#windowDocs").get(0)}),n.addControl(O);let e=new F({closeBox:!0,className:"slide-left menu",content:o("#windowLayers").get(0)});n.addControl(e);let t=document.getElementById("layers");We.renderPanel(n,t,{reverse:!0});let l=new F({closeBox:!0,className:"slide-left menu",content:o("#windowSearch").get(0)});n.addControl(l),R=new F({closeBox:!0,className:"slide-right info",content:o("#windowFeature").get(0)}),n.addControl(R);let c=new B({className:"ol-top ol-left menuBar"});n.addControl(c);let a=new B({toggleOne:!0,group:!0});c.addControl(a);let r=new W({html:'<img src="logo.png" />',className:"logo",title:"Castelldefels",handleClick:function(){n.getView().setCenter(pe),n.getView().setZoom(me)}});a.addControl(r),M=new b({html:'<i class="fa fa-file-text-o"></i>',className:"docsToggle",onToggle:function(){d("docs"),O.toggle()}}),a.addControl(M),I=new b({html:'<i class="fa fa-align-justify"></i>',className:"layersToggle",onToggle:function(){d("layers"),e.toggle()}}),a.addControl(I),j=new b({html:'<i class="fa fa-search"></i>',className:"searchToggle",onToggle:function(){d("search"),l.toggle()}}),a.addControl(j);function d(v){O.hide(),e.hide(),l.hide(),v!=="docs"?M.setActive(!1):v!=="layers"?I.setActive(!1):v!=="search"&&j.setActive(!1)}let w=new W({html:'<i class="fa fa-whatsapp" aria-hidden="true"></i>',className:"whatsapp",title:"Whatsapp",handleClick:function(){}});a.addControl(w);let h=new W({html:'<i class="fa fa-telegram" aria-hidden="true"></i>',className:"telegram",title:"Telegram",handleClick:function(){}});a.addControl(h);let m=new B({toggleOne:!0,group:!0});c.addControl(m),K=new b({html:"CA",className:"lang ca",title:"Catal\xE0",onToggle:function(){i.changeLanguage("ca")}}),m.addControl(K),$=new b({html:"ES",className:"lang es",title:"Castellano",onToggle:function(){i.changeLanguage("es")}}),m.addControl($),o(".window").show()}function st(){we=new Ye({urlReplace:!0}),n.addControl(we),G=new Ue({delay:5e3}),n.addControl(G);let e=new Je({positioning:"bottom-center"});n.addOverlay(e),G.on("position",function(s){s.coordinate?e.show(s.coordinate,"Ets aqu\xED!"):e.hide()});let t,l,c,a,r,d="Click per continuar dibuixant el pol\xEDgon",w="Click per continuar dibuixant la l\xEDnea",h="Clica per iniciar el dibuix",m,v=!1;const q=new L,Le=new T({source:q,style:new f({fill:new k({color:"rgba(255, 255, 255, 0.2)"}),stroke:new g({color:"#ffcc33",width:2}),image:new ue({radius:7,fill:new k({color:"#ffcc33"})})})});n.addLayer(Le),n.on("pointermove",function(s){v?_e(s):n.getTargetElement().style.cursor=n.hasFeatureAtPixel(n.getEventPixel(s.originalEvent),{hitTolerance:5,layerFilter:function(u){return u.get("name")==="trams"||u.get("name")==="parcelles"}})?"pointer":""}),o(document).keyup(function(s){s.keyCode==27&&(n.removeInteraction(m),n.removeOverlay(r),D(),o(".ol-tooltip").addClass("hidden"),E.toggle())}),Q=new b({html:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -8)"><path d="m1.5000001 20.5h21v7h-21z" style="overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square"/><path d="m4.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m7.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m10.5 20v6" fill="none" stroke="#5b5b5c"/><path d="m13.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m16.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m19.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m2.5 13v4" fill="none" stroke="#415a75"/><path d="m21.5 13v4" fill="none" stroke="#415a75"/><path d="m2 15h20" fill="none" stroke="#415a75" stroke-width="1.99999988"/></g></svg>',onToggle:function(s){v=s,ae(s,!0)}}),X=new b({html:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -8)"><path d="m1.5000001 20.5h21v7h-21z" style="overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square"/><path d="m4.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m7.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m10.5 20v6" fill="none" stroke="#5b5b5c"/><path d="m13.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m16.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m19.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m2.5 9.5h5v2h14v7.5h-6.5v-5h-5v3.5h-7.5z" fill="#6d97c4" fill-rule="evenodd" stroke="#415a75"/></g></svg>',onToggle:function(s){v=s,ae(s,!1)}});let ke=new B({toggleOne:!0,autoDeactivate:!0,controls:[Q,X]});E=new b({html:"M",bar:ke,onToggle:function(s){s||(ne(),this.toggle())}});let xe=new B({autoDeactivate:!0,controls:[E],className:"ol-top ol-right measureBar"});n.addControl(xe);function ae(s,u){s?Ne(u):ne()}function Ne(s){var u=s?"LineString":"Polygon";m=new Ke({source:q,type:u,style:new f({fill:new k({color:"rgba(255, 255, 255, 0.2)"}),stroke:new g({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ue({radius:5,stroke:new g({color:"rgba(0, 0, 0, 0.7)"}),fill:new k({color:"rgba(255, 255, 255, 0.2)"})})})}),n.addInteraction(m),le(),Se();let p;m.on("drawstart",function(ie){t=ie.feature;var z=ie.coordinate;p=t.getGeometry().on("change",function(Ee){var x=Ee.target,H;x instanceof de?(H=Me(x),z=x.getInteriorPoint().getCoordinates()):x instanceof fe&&(H=Be(x),z=x.getLastCoordinate()),a.innerHTML=H,r.setPosition(z)})}),m.on("drawend",function(){a.className="ol-tooltip ol-tooltip-static",r.setOffset([0,-7]),t=null,a=null,le(),$e(p)})}function ne(){v=!1,n.removeInteraction(m),n.removeOverlay(r),D(),o(".ol-tooltip").addClass("hidden"),E.toggle(),q.clear()}function Se(){D(),l=document.createElement("div"),l.className="ol-tooltip hidden",c=new ge({element:l,offset:[15,0],positioning:"center-left"}),n.addOverlay(c),n.getViewport().addEventListener("mouseout",re)}var re=function(){l.classList.add("hidden")};function D(){n.removeOverlay(c),n.getViewport().removeEventListener("mouseout",re)}function le(){a&&a.parentNode.removeChild(a),a=document.createElement("div"),a.className="ol-tooltip ol-tooltip-measure",r=new ge({element:a,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n.addOverlay(r)}var _e=function(s){if(!s.dragging){if(t){var u=t.getGeometry();u instanceof de?h=d:u instanceof fe&&(h=w)}l&&l!==void 0&&(l.innerHTML=h,c.setPosition(s.coordinate),l.classList.remove("hidden"))}},Be=function(s){var u=Qe(s),p;return u>100?p=Math.round(u/1e3*100)/100+" km":p=Math.round(u*100)/100+" m",p},Me=function(s){var u=Xe(s),p;return u>1e4?p=Math.round(u/1e6*100)/100+" km<sup>2</sup>":p=Math.round(u*100)/100+" m<sup>2</sup>",p}}let be=new f({stroke:new g({color:"#ffff00",width:5}),fill:new k({color:"rgba(255, 255, 0, 0.1)"})}),V=new Ve({layers:[he,ve],hitTolerance:5,style:be});n.addInteraction(V);V.getFeatures().on("add",function(e){let t=e.element,l=V.getLayer(t).get("name"),c=o("<div>");l==="trams"?c.append(y(t,"eix_ncar")).append(y(t,"observacions")).append(y(t,"estat")).append(y(t,"data_inici_obres")).append(y(t,"data_fi_obres")):l==="parcelles"&&c.append(y(t,"refcat")).append(y(t,"residual")).append(y(t,"conveni")),o("#windowFeature .content").html(c),R.show()});V.getFeatures().on("remove",function(e){o("#windowFeature .content").html(""),R.hide()});function y(e,t){return o("<p>").html("<span class='label "+t+"'>"+i.t(t)+"</span>: "+e.get(t))}o.get("./carrers.txt",function(e){let t=e.split(`,
`),l=t.length;o("#searchCarrer").keyup(function(){document.getElementById("carrerList").innerHTML="",o("#searchNumero").empty();for(let a=0;a<l;a++){let r=t[a].split(",");if(r[1].toLowerCase().indexOf(o("#searchCarrer").val().toLowerCase())>-1){let d=document.createElement("option"),w=document.createTextNode(r[1]),h=document.createAttribute("value");h.value=r[0],d.appendChild(w),d.setAttributeNode(h),document.getElementById("carrerList").appendChild(d)}}}),o("#searchCarrer").on("input",function(){o("#searchMsg").text("");let a=this.value;o("#carrerList option").filter(function(){return this.value.toUpperCase()===a.toUpperCase()}).length&&c(this.value)});function c(a){console.log(a),a&&a!==""&&o.ajax({url:"https://mapa.psig.es/bellamar/ajaxpg/ajaxfile.php",type:"post",data:{request:"carrersNum",carrer:a},dataType:"json",success:function(r){if(console.log(r),r.length>0){o("#searchNumero").empty(),o("#searchNumero").append('<option value="-1"> - Tri\xEF un carrer - </option>');for(var d in r){var w=JSON.parse(r[d].geom);o("#searchNumero").append('<option data-x="'+w.coordinates[0][0]+'" data-y="'+w.coordinates[0][1]+'">'+r[d].npol_num1+"</option>")}}else o("#searchMsg").text("No ha hi cap n\xFAmero de aquest carrer.")}})}});o("#searchNumero").on("change",function(){var e=Number(this.options[this.selectedIndex].getAttribute("data-x")),t=Number(this.options[this.selectedIndex].getAttribute("data-y"));return Ce(e)&&Ce(t)&&(ye(e,t,!1),ut([e,t])),!1});o("#searchReferenciaBtn").click(function(){o("#searchMsg").text(""),C!==null&&C.clear();let e=o("#searchReferencia").val().trim();e&&e!==""&&o.ajax({url:"https://mapa.psig.es/bellamar/ajaxpg/ajaxfile.php",type:"post",data:{request:"catasterGeom",refcat:e},dataType:"json",success:function(t){t.length>0?(ye(t[0].coorx,t[0].coory,!0),ct(t[0].geom)):o("#searchMsg").text("No ha hi cap parcela amb aquesta refer\xE8ncia cadastral.")}})});function ye(e,t,l=!1){console.log("zoomToCoord:"+e+":"+t);let c=[e,t];l&&(c=qe([e,t],De("EPSG:25831"),"EPSG:3857")),n.getView().animate({zoom:n.getView().getZoom()+1,center:c,duration:2e3})}let ee=null,C=null;function ct(e){e&&(ee===null?(C=new L({features:new S().readFeatures(e)}),ee=new T({source:C,style:be}),n.addLayer(ee)):(C.clear(),C.addFeatures(new S().readFeatures(e))))}let A=null,te=null;function ut(e){console.log("showIcon:"+e[0]+":"+e[1]),A===null?(te=new ze(e),A=new T({source:new L({features:[new He({geometry:te})]}),style:new f({image:new Icon({anchor:[.5,0],anchorOrigin:"bottom-left",color:[255,0,0,1],src:"./marker.png"})})}),n.addLayer(A)):te.setCoordinates(e)}function Ce(e){return!isNaN(parseFloat(e))&&isFinite(e)}n.on("click",function(e){C!==null&&C.clear(),n.removeLayer(A),A=null,console.log(Ze(e.coordinate))});const oe={sameSite:"strict",secure:!0};function dt(){_.get("comeback")===void 0&&(_.set("comeback",!0,oe),M.setActive(!0),O.show()),o.ajax({url:"./translations.json",dataType:"json",success:function(e){let t=ft();i.init({lng:t,debug:!0,resources:e}).then(function(l){Te(),i.on("languageChanged",()=>{_.set("lang",i.language,oe),Te()})})}})}function ft(){let e="ca";_.get("lang")===void 0?_.set("lang",e,oe):e=_.get("lang");let t=navigator.language||navigator.userLanguage;return console.log("The language is: "+e+" (Browser language:"+t+")"),e==="es"?$.setActive(!0):K.setActive(!0),e}function Te(){M.setTitle(i.t("documents")),I.setTitle(i.t("capes")),j.setTitle(i.t("search")),o(".ol-permalink button").attr("title",i.t("urlmsg")),G.setTitle(i.t("geopos")),E.setTitle(i.t("measure")),Q.setTitle(i.t("measureDistance")),X.setTitle(i.t("measureArea")),o(".ol-attribution button").attr("title",i.t("attribution")),o("#windowDocs .title").text(i.t("windowDocsTitle")),o("#windowLayers .title").text(i.t("windowLayersTitle")),o("#windowSearch .title").text(i.t("windowSearchTitle")),o("#windowFeature .title").text(i.t("windowFeatureTitle")),o("#windowFeature .label.eix_ncar").text(i.t("eix_ncar")),o("#windowFeature .label.observacions").text(i.t("observacions")),o("#windowFeature .label.estat").text(i.t("estat")),o("#windowFeature .label.data_inici_obres").text(i.t("data_inici_obres")),o("#windowFeature .label.data_fi_obres").text(i.t("data_fi_obres")),o("#windowFeature .label.refcat").text(i.t("refcat")),o("#windowFeature .label.residual").text(i.t("residual")),o("#windowFeature .label.conveni").text(i.t("conveni"))}o(function(){it(),st(),dt()});
//# sourceMappingURL=index.289c7e12.js.map
