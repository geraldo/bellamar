import{f as ve,p as K,r as be,G as $,T as b,O as ye,a as Ce,b as O,V as g,c as h,d as y,S as c,e as u,F as w,M as Le,g as ke,h as xe,i as Ne,o as S,$ as o,L as Se,j as T,k as P,l as C,m as Te,n as _e,q as Me,C as Q,D as Be,P as X,s as ee,u as Ee,t as te,v as Oe,w as Pe,x as Ie,y as Ae,z as je,A as Fe,B as Ge,E as We}from"./vendor.e56febc6.js";const Re=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}};Re();const oe=16,ae=ve([1.957,41.271]),Ve="https://mapa.psig.es/mapproxy/service",I="https://mapa.psig.es/qgisserver/wfs3/collections/",A="/items.geojson",_="?MAP=/home/ubuntu/bellamar/Obra_Bellamar_web.qgs",j="&limit=10000";K.defs("EPSG:25831","+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");be(K);let qe=new $({title:"Mapes base",layers:[new b({title:"Ning\xFA",type:"base",source:null,visible:!1}),new b({title:"OpenStreetMap",type:"base",visible:!1,source:new ye}),new b({title:"Ortofoto hist\xF2rica de 2020 (AMB)",type:"base",visible:!1,source:new Ce({url:"https://geoportal.amb.cat/geoserveis/rest/services/ortofoto_territorial_10cm_2020_25831/MapServer",projection:"EPSG:25831",params:{LAYERS:"Orto2020_10cm"},attributions:['\xA9 <a target="_blank" href="https://www.amb.cat/">AMB</a>']})}),new b({title:"Topogr\xE1fic (AMB)",type:"base",visible:!0,maxZoom:18,source:new O({url:"http://geoserveis.icc.cat/icc_mapesmultibase/utm/wms/service?",params:{LAYERS:"topogris",VERSION:"1.1.1"},attributions:['Cartografia topogr\xE0fica 1:1.000 de l\u2019<a target="_blank" href="http://www.icgc.cat/">Institut Cartogr\xE0fic i Geol\xF2gic de Catalunya (ICGC)</a>, sota una llic\xE8ncia <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/deed.ca">CC BY 4.0</a>']})})]}),ze=new b({title:"Topografia completa",visible:!0,minZoom:18,source:new O({url:Ve+_,params:{LAYERS:"bellamar_topografia",TRANSPARENT:!0,VERSION:"1.3.0"},serverType:"qgis"})}),De=new b({title:"Catastro",visible:!1,source:new O({url:"http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx",params:{LAYERS:"catastro",TILED:!0,SRS:"EPSG:3857"}})}),He=new g({title:"Pluvial",visible:!0,source:new h({format:new y,url:I+"bellamar_pluvial"+A+_+j}),style:new c({stroke:new u({lineDash:[10,5],color:"#1f78b4",width:3})})}),re=new g({title:"Trams de les obres",name:"trams",visible:!0,source:new h({format:new y,url:I+"Trams de les obres"+A+_+j}),style:function(e,t){let n=e.get("estat");return n==="finalitzat"?new c({stroke:new u({color:"#09de00",width:2})}):n==="en obra"?new c({stroke:new u({color:"#db1e2a",width:2})}):n==="inici en breu"?new c({stroke:new u({color:"#ff8c00",width:2})}):n==="pendent"?new c({stroke:new u({color:"#0076b6",width:2})}):n==="excl\xF2s"?new c({stroke:new u({color:"#929397",width:1})}):new c({stroke:new u({color:"#ffff00",width:1})})}}),ne=new g({title:"Parcel\xB7les projecte Bellamar",name:"parcelles",visible:!0,source:new h({format:new y,url:I+"Parcel\xB7les projecte Bellamar"+A+_+j}),style:function(e,t){return e.get("residual")==="No"?new c({fill:new w({color:"rgba(196,154,151,0.4)"})}):e.get("residual")==="S\xED"?new c({fill:new w({color:"rgba(135,105,100,0.4)"})}):null}}),Ze=new g({title:"Barris",visible:!0,source:new h({format:new y,url:"barris.geojson"}),style:new c({stroke:new u({color:"#000",width:2})})});const a=new Le({target:"map",controls:ke().extend([new xe]),layers:new $({title:"Mapes base",fold:"close",layers:[qe,De,ze,Ze,He,re,ne]}),view:new Ne({center:ae,zoom:oe,minZoom:14,maxZoom:20})});let F=new S({closeBox:!0,className:"slide-left menu",content:o("#infoWindowDocs").get(0)});a.addControl(F);let G=new S({closeBox:!0,className:"slide-left menu",content:o("#infoWindowLayers").get(0)});a.addControl(G);let Ye=document.getElementById("layers");Se.renderPanel(a,Ye,{reverse:!0});let W=new S({closeBox:!0,className:"slide-left menu",content:o("#infoWindowSearch").get(0)});a.addControl(W);let R=new S({closeBox:!0,className:"slide-right info",content:o("#infoWindowFeature").get(0)});a.addControl(R);let le=new T({className:"ol-top ol-left menuBar"});a.addControl(le);let v=new T({toggleOne:!0,group:!0});le.addControl(v);let Ue=new P({html:'<img src="logo.png" />',className:"logo",title:"Castelldefels",handleClick:function(){a.getView().setCenter(ae),a.getView().setZoom(oe)}});v.addControl(Ue);let ie=new C({html:'<i class="fa fa-file-text-o"></i>',className:"docs",title:"Documents",onToggle:function(){V("docs"),F.toggle()}});v.addControl(ie);let se=new C({html:'<i class="fa fa-align-justify"></i>',className:"layers",title:"Capas",onToggle:function(){V("layers"),G.toggle()}});v.addControl(se);let ce=new C({html:'<i class="fa fa-search"></i>',className:"search",title:"Buscar",onToggle:function(){V("search"),W.toggle()}});v.addControl(ce);function V(e){F.hide(),G.hide(),W.hide(),e!=="docs"?ie.setActive(!1):e!=="layers"?se.setActive(!1):e!=="search"&&ce.setActive(!1)}let Je=new P({html:'<i class="fa fa-whatsapp" aria-hidden="true"></i>',className:"whatsapp",title:"Whatsapp",handleClick:function(){}});v.addControl(Je);let Ke=new P({html:'<i class="fa fa-telegram" aria-hidden="true"></i>',className:"telegram",title:"Whatsapp",handleClick:function(){}});v.addControl(Ke);o(".window").show();let $e=new Te({urlReplace:!0,title:"Compartir enlla\xE7"});a.addControl($e);let ue=new _e({title:"On estic?",delay:5e3});a.addControl(ue);let q=new Me({positioning:"bottom-center"});a.addOverlay(q);ue.on("position",function(e){e.coordinate?q.show(e.coordinate,"Ets aqu\xED!"):q.hide()});let x,p,M,d,L,Qe="Click per continuar dibuixant el pol\xEDgon",Xe="Click per continuar dibuixant la l\xEDnea",z="Clica per iniciar el dibuix",k,B=!1;const D=new h,et=new g({source:D,style:new c({fill:new w({color:"rgba(255, 255, 255, 0.2)"}),stroke:new u({color:"#ffcc33",width:2}),image:new Q({radius:7,fill:new w({color:"#ffcc33"})})})});a.addLayer(et);a.on("pointermove",function(e){B?nt(e):a.getTargetElement().style.cursor=a.hasFeatureAtPixel(a.getEventPixel(e.originalEvent),{hitTolerance:5,layerFilter:function(t){return t.get("name")==="trams"||t.get("name")==="parcelles"}})?"pointer":""});o(document).keyup(function(e){e.keyCode==27&&(a.removeInteraction(k),a.removeOverlay(L),Z(),o(".ol-tooltip").addClass("hidden"),H.toggle())});let tt=new T({toggleOne:!0,autoDeactivate:!0,controls:[new C({title:"Medir distancia",html:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -8)"><path d="m1.5000001 20.5h21v7h-21z" style="overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square"/><path d="m4.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m7.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m10.5 20v6" fill="none" stroke="#5b5b5c"/><path d="m13.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m16.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m19.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m2.5 13v4" fill="none" stroke="#415a75"/><path d="m21.5 13v4" fill="none" stroke="#415a75"/><path d="m2 15h20" fill="none" stroke="#415a75" stroke-width="1.99999988"/></g></svg>',onToggle:function(e){B=e,de(e,!0)}}),new C({title:"Medir \xE0rea",html:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -8)"><path d="m1.5000001 20.5h21v7h-21z" style="overflow:visible;fill:#c7c7c7;fill-rule:evenodd;stroke:#5b5b5c;stroke-width:.99999994;stroke-linecap:square"/><path d="m4.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m7.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m10.5 20v6" fill="none" stroke="#5b5b5c"/><path d="m13.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m16.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m19.5 21v3" fill="none" stroke="#5b5b5c"/><path d="m2.5 9.5h5v2h14v7.5h-6.5v-5h-5v3.5h-7.5z" fill="#6d97c4" fill-rule="evenodd" stroke="#415a75"/></g></svg>',onToggle:function(e){B=e,de(e,!1)}})]}),H=new C({html:"M",bar:tt,title:"Medir",onToggle:function(e){e||(fe(),this.toggle())}}),ot=new T({autoDeactivate:!0,controls:[H],className:"ol-top ol-right measureBar"});a.addControl(ot);function de(e,t){e?at(t):fe()}function at(e){var t=e?"LineString":"Polygon";k=new Be({source:D,type:t,style:new c({fill:new w({color:"rgba(255, 255, 255, 0.2)"}),stroke:new u({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new Q({radius:5,stroke:new u({color:"rgba(0, 0, 0, 0.7)"}),fill:new w({color:"rgba(255, 255, 255, 0.2)"})})})}),a.addInteraction(k),me(),rt();let n;k.on("drawstart",function(s){x=s.feature;var r=s.coordinate;n=x.getGeometry().on("change",function(l){var i=l.target,f;i instanceof X?(f=it(i),r=i.getInteriorPoint().getCoordinates()):i instanceof ee&&(f=lt(i),r=i.getLastCoordinate()),d.innerHTML=f,L.setPosition(r)})}),k.on("drawend",function(){d.className="ol-tooltip ol-tooltip-static",L.setOffset([0,-7]),x=null,d=null,me(),Ee(n)})}function fe(){B=!1,a.removeInteraction(k),a.removeOverlay(L),Z(),o(".ol-tooltip").addClass("hidden"),H.toggle(),D.clear()}function rt(){Z(),p=document.createElement("div"),p.className="ol-tooltip hidden",M=new te({element:p,offset:[15,0],positioning:"center-left"}),a.addOverlay(M),a.getViewport().addEventListener("mouseout",pe)}var pe=function(){p.classList.add("hidden")};function Z(){a.removeOverlay(M),a.getViewport().removeEventListener("mouseout",pe)}function me(){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="ol-tooltip ol-tooltip-measure",L=new te({element:d,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),a.addOverlay(L)}var nt=function(e){if(!e.dragging){if(x){var t=x.getGeometry();t instanceof X?z=Qe:t instanceof ee&&(z=Xe)}p&&p!==void 0&&(p.innerHTML=z,M.setPosition(e.coordinate),p.classList.remove("hidden"))}},lt=function(e){var t=Oe(e),n;return t>100?n=Math.round(t/1e3*100)/100+" km":n=Math.round(t*100)/100+" m",n},it=function(e){var t=Pe(e),n;return t>1e4?n=Math.round(t/1e6*100)/100+" km<sup>2</sup>":n=Math.round(t*100)/100+" m<sup>2</sup>",n};let ge=new c({stroke:new u({color:"#ffff00",width:5}),fill:new w({color:"rgba(255, 255, 0, 0.1)"})}),E=new Ie({layers:[re,ne],hitTolerance:5,style:ge});a.addInteraction(E);E.getFeatures().on("add",function(e){let t=e.element,n=E.getLayer(t).get("name"),s=o("<div>");n==="trams"?s.append(o("<p>").text("eix_ncar: "+t.get("eix_ncar"))).append(o("<p>").text("observacions: "+t.get("observacions"))).append(o("<p>").text("estat: "+t.get("estat"))).append(o("<p>").text("data_inici_obres: "+t.get("data_inici_obres"))).append(o("<p>").text("data_fi_obres: "+t.get("data_fi_obres"))):n==="parcelles"&&s.append(o("<p>").text("refcat: "+t.get("refcat"))).append(o("<p>").text("residual: "+t.get("residual"))).append(o("<p>").text("conveni: "+t.get("conveni"))),o("#infoWindowFeature .content").html(s),R.show()});E.getFeatures().on("remove",function(e){o("#infoWindowFeature .content").html(""),R.hide()});o.get("./carrers.txt",function(e){let t=e.split(`,
`),n=t.length;o("#searchCarrer").keyup(function(){document.getElementById("carrerList").innerHTML="",o("#searchNumero").empty();for(let r=0;r<n;r++){let l=t[r].split(",");if(l[1].toLowerCase().indexOf(o("#searchCarrer").val().toLowerCase())>-1){let i=document.createElement("option"),f=document.createTextNode(l[1]),J=document.createAttribute("value");J.value=l[0],i.appendChild(f),i.setAttributeNode(J),document.getElementById("carrerList").appendChild(i)}}}),o("#searchCarrer").on("input",function(){o("#searchMsg").text("");let r=this.value;o("#carrerList option").filter(function(){return this.value.toUpperCase()===r.toUpperCase()}).length&&s(this.value)});function s(r){console.log(r),r&&r!==""&&o.ajax({url:"https://mapa.psig.es/bellamar/ajaxpg/ajaxfile.php",type:"post",data:{request:"carrersNum",carrer:r},dataType:"json",success:function(l){if(console.log(l),l.length>0){o("#searchNumero").empty(),o("#searchNumero").append('<option value="-1"> - Tri\xEF un carrer - </option>');for(var i in l){var f=JSON.parse(l[i].geom);o("#searchNumero").append('<option data-x="'+f.coordinates[0][0]+'" data-y="'+f.coordinates[0][1]+'">'+l[i].npol_num1+"</option>")}}else o("#searchMsg").text("No ha hi cap n\xFAmero de aquest carrer.")}})}});o("#searchNumero").on("change",function(){var e=Number(this.options[this.selectedIndex].getAttribute("data-x")),t=Number(this.options[this.selectedIndex].getAttribute("data-y"));return we(e)&&we(t)&&(he(e,t,!1),ct([e,t])),!1});o("#searchReferenciaBtn").click(function(){o("#searchMsg").text(""),m!==null&&m.clear();let e=o("#searchReferencia").val().trim();e&&e!==""&&o.ajax({url:"https://mapa.psig.es/bellamar/ajaxpg/ajaxfile.php",type:"post",data:{request:"catasterGeom",refcat:e},dataType:"json",success:function(t){t.length>0?(he(t[0].coorx,t[0].coory,!0),st(t[0].geom)):o("#searchMsg").text("No ha hi cap parcela amb aquesta refer\xE8ncia cadastral.")}})});function he(e,t,n=!1){console.log("zoomToCoord:"+e+":"+t);let s=[e,t];n&&(s=Ae([e,t],je("EPSG:25831"),"EPSG:3857")),a.getView().animate({zoom:a.getView().getZoom()+1,center:s,duration:2e3})}let Y=null,m=null;function st(e){e&&(Y===null?(m=new h({features:new y().readFeatures(e)}),Y=new g({source:m,style:ge}),a.addLayer(Y)):(m.clear(),m.addFeatures(new y().readFeatures(e))))}let N=null,U=null;function ct(e){console.log("showIcon:"+e[0]+":"+e[1]),N===null?(U=new Fe(e),N=new g({source:new h({features:[new Ge({geometry:U})]}),style:new c({image:new Icon({anchor:[.5,0],anchorOrigin:"bottom-left",color:[255,0,0,1],src:"./marker.png"})})}),a.addLayer(N)):U.setCoordinates(e)}function we(e){return!isNaN(parseFloat(e))&&isFinite(e)}a.on("click",function(e){m!==null&&m.clear(),a.removeLayer(N),N=null,console.log(We(e.coordinate))});
//# sourceMappingURL=index.1a09b141.js.map
